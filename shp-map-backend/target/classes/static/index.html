<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>上海海平面上升风险预警决策系统</title>
  <!-- 1. 引入Vue3 -->
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
  <!-- 2. 引入Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <!-- 引入ECharts（用于渲染折线图/柱状图） -->
  <script src="https://cdn.bootcdn.net/ajax/libs/echarts/5.4.3/echarts.min.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html,
    body,
    #app {
      width: 100%;
      height: 100%;
      overflow: hidden;
    }

    /* 标题栏 */
    .header-bar {
      height: 60px;
      background: linear-gradient(to right, #002244, #0066cc, #002244);
      color: #fff;
      font-size: 24px;
      font-weight: bold;
      text-align: center;
      line-height: 60px;
      text-shadow: 0 0 10px #00ccff;
      border-bottom: 2px solid #00ccff;
      z-index: 999;
    }

    /* 选项栏 */
    .option-bar {
      height: 40px;
      background: linear-gradient(to right, #003366, #0055aa);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0 20px;
      gap: 40px;
      border-bottom: 1px solid #00ccff;
      z-index: 998;
    }

    /* 回到初始按钮 */
    .reset-btn {
      background: #004488;
      color: #fff;
      border: 1px solid #00ccff;
      padding: 5px 20px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
    }

    .reset-btn:hover {
      background: #0055aa;
    }

    /* 下拉框2 */
    .dropdown {
      position: relative;
    }

    .dropdown-btn {
      background: #004488;
      color: #fff;
      border: 1px solid #00ccff;
      padding: 5px 20px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
    }

    .dropdown-btn:hover {
      background: #0055aa;
    }

    .dropdown-menu {
      position: absolute;
      top: 100%;
      left: 50%;
      transform: translateX(-50%);
      width: 260px;
      background: #002244;
      border: 1px solid #00ccff;
      border-radius: 4px;
      padding: 10px 0;
      display: none;
      z-index: 999;
    }

    .dropdown-menu.show {
      display: block;
    }

    .menu-item {
      color: #fff;
      padding: 8px 15px;
      font-size: 13px;
      cursor: pointer;
    }

    .menu-item:hover {
      background: #0055aa;
    }

    /* 地图容器（核心：ID严格为map，确保存在） */
    #map {
      position: absolute;
      top: 100px;
      left: 0;
      width: 100%;
      height: calc(100% - 100px);
      z-index: 990;
    }

    /* 侧边栏 */
    .sidebar {
      position: absolute;
      top: 120px;
      left: 20px;
      width: 260px;
      background: rgba(0, 34, 68, 0.9);
      border: 1px solid #00ccff;
      border-radius: 4px;
      z-index: 995;
    }

    .sidebar-main-item {
      color: #fff;
      padding: 12px 15px;
      font-size: 14px;
      cursor: pointer;
      border-bottom: 1px solid #0055aa;
      display: flex;
      justify-content: space-between;
      align-items: center;
      white-space: nowrap;
    }

    .sidebar-main-item:hover {
      background: #0055aa;
    }

    .sidebar-sub-list {
      display: none;
      background: rgba(0, 51, 102, 0.95);
    }

    .sidebar-sub-list.show {
      display: block;
    }

    .sidebar-sub-item {
      color: #fff;
      padding: 9px 25px;
      font-size: 13px;
      cursor: pointer;
      white-space: nowrap;
    }

    .sidebar-sub-item:hover {
      background: #0066cc;
    }

    .sidebar-sub-item.active {
      background: #00ccff;
      color: #002244;
      font-weight: bold;
    }

    /* 地图切换按钮 */
    .map-switch {
      position: absolute;
      bottom: 20px;
      right: 20px;
      display: flex;
      z-index: 997;
    }

    .switch-btn {
      background: rgba(0, 51, 102, 0.9);
      color: #fff;
      border: 1px solid #00ccff;
      padding: 5px 10px;
      cursor: pointer;
      font-size: 12px;
    }

    .switch-btn.active {
      background: #00ccff;
      color: #002244;
      font-weight: bold;
    }

    /* 站点提示框样式 */
    .station-tooltip {
      background: rgba(0, 34, 68, 0.9);
      color: #fff;
      padding: 3px 8px;
      border-radius: 2px;
      font-size: 12px;
      border: 1px solid #00ccff;
    }

    /* 历史数据表格样式 */
    .history-table-container {
      position: absolute;
      top: 120px;
      right: 20px;
      width: 500px;
      max-height: calc(100% - 140px);
      background: rgba(0, 22, 44, 0.95);
      border: 1px solid #00ccff;
      border-radius: 4px;
      z-index: 996;
      display: none;
      overflow: hidden;
    }

    .history-table-container.show {
      display: block;
    }

    .table-header {
      padding: 12px 15px;
      background: linear-gradient(to right, #003366, #0055aa);
      color: #fff;
      font-size: 14px;
      font-weight: bold;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid #00ccff;
    }

    .close-table {
      cursor: pointer;
      font-size: 16px;
    }

    .table-content {
      width: 100%;
      max-height: calc(100% - 44px);
      overflow-y: auto;
    }

    .history-table {
      width: 100%;
      border-collapse: collapse;
      color: #fff;
      font-size: 13px;
    }

    .history-table th {
      background: rgba(0, 51, 102, 0.9);
      padding: 10px 8px;
      text-align: left;
      border-bottom: 1px solid #0055aa;
      position: sticky;
      top: 0;
    }

    .history-table td {
      padding: 8px;
      border-bottom: 1px solid #0055aa;
    }

    .history-table tr:hover {
      background: rgba(0, 88, 170, 0.5);
    }

    .loading {
      color: #fff;
      padding: 20px;
      text-align: center;
      font-size: 13px;
    }

    /* 1. 站点数据弹窗样式 */
    .station-data-popup {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 600px;
      max-height: 80vh;
      background: rgba(0, 22, 44, 0.98);
      border: 2px solid #00ccff;
      border-radius: 8px;
      z-index: 1000;
      display: none;
      overflow: hidden;
    }

    .station-data-popup.show {
      display: block;
    }

    .popup-header {
      padding: 12px 15px;
      background: linear-gradient(to right, #003366, #0055aa);
      color: #fff;
      font-size: 16px;
      font-weight: bold;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .popup-close {
      cursor: pointer;
      font-size: 20px;
    }

    .popup-content {
      width: 100%;
      max-height: calc(80vh - 48px);
      overflow-y: auto;
    }

    /* 2. 全量数据按钮+搜索区样式 */
    .full-data-control {
      position: absolute;
      top: 120px;
      right: 20px;
      z-index: 995;
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .full-data-btn {
      padding: 8px 15px;
      background: #004488;
      color: #fff;
      border: 1px solid #00ccff;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
    }

    .full-data-btn:hover {
      background: #0055aa;
    }

    .search-area {
      margin: 10px;
      display: flex;
      gap: 10px;
      align-items: center;
      color: #fff;
    }

    .search-area input {
      padding: 6px 10px;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid #00ccff;
      border-radius: 4px;
      color: #fff;
      outline: none;
    }

    .search-area input::placeholder {
      color: #ccc;
    }

    /* 分页控件样式（新增） */
    .pagination {
      padding: 15px;
      text-align: center;
      color: #fff;
    }

    .pagination-controls {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      flex-wrap: wrap;
    }

    .page-btn {
      padding: 5px 12px;
      background: #004488;
      color: #fff;
      border: 1px solid #00ccff;
      border-radius: 4px;
      cursor: pointer;
      font-size: 13px;
    }

    .page-btn:disabled {
      background: #002244;
      cursor: not-allowed;
      opacity: 0.7;
    }

    .page-num {
      padding: 5px 12px;
      background: #004488;
      color: #fff;
      border: 1px solid #00ccff;
      border-radius: 4px;
      cursor: pointer;
      font-size: 13px;
    }

    .page-num.active {
      background: #00ccff;
      color: #002244;
      font-weight: bold;
    }

    .page-size-select {
      display: flex;
      align-items: center;
      gap: 5px;
      font-size: 13px;
    }

    .page-size-select select {
      padding: 5px;
      background: rgba(255, 255, 255, 0.1);
      color: #fff;
      border: 1px solid #00ccff;
      border-radius: 4px;
      outline: none;
    }

    .page-info {
      font-size: 13px;
      color: #ccc;
    }
  </style>
</head>

<body>
  <div id="app">
    <!-- 标题栏 -->
    <div class="header-bar">
      上海海平面上升风险预警决策系统
    </div>

    <!-- 选项栏 -->
    <div class="option-bar">
      <button class="reset-btn" @click="resetToInitial()">
        海平面上升精细化预测
      </button>

      <div class="dropdown">
        <button class="dropdown-btn" @click="toggleMenu('menu2')">
          {{ btnText2 }} ▾
        </button>
        <div class="dropdown-menu" :class="{show: activeMenu === 'menu2'}">
          <div class="menu-item" @click="switchView('risk1')">重大承灾体海平面上升风险预警</div>
          <div class="menu-item" @click="switchView('risk2')">海平面上升下岸线侵蚀风险预警</div>
          <div class="menu-item" @click="switchView('risk3')">滨海生态系统挤压风险预警</div>
          <div class="menu-item" @click="switchView('risk4')">海平面上升下城市洪涝事件风险预警</div>
          <div class="menu-item" @click="switchView('seawater')">江苏省海水入侵风险辅助决策</div>
          <div class="menu-item" @click="switchView('salt')">江苏省咸潮入侵风险辅助决策</div>
        </div>
      </div>
    </div>

    <!-- 地图容器（核心：ID严格为map，确保存在） -->
    <div id="map"></div>

    <!-- 侧边栏（5个模块） -->
    <div class="sidebar" v-if="currentView === 'seawater'">
      <!-- 模块1：海水入侵监测站位地图展示 -->
      <div class="sidebar-main-item" @click="toggleSidebar('item1')">
        海水入侵监测站位地图展示
        <span>{{ sidebarOpen.item1 ? '▾' : '▸' }}</span>
      </div>
      <div class="sidebar-sub-list" :class="{show: sidebarOpen.item1}">
        <div class="sidebar-sub-item" @click="clearAllLayers()">基础底图展示</div>
        <div class="sidebar-sub-item" :class="{active: isStationActive}" @click="loadSeawaterStations()">标注监测站点展示</div>
        <div class="sidebar-sub-item" @click="clearAllLayers()">添加标注信息</div>
        <div class="sidebar-sub-item" @click="loadShpGeoJson()">加载SHP风险线</div>
      </div>

      <!-- 模块2：海水入侵历史监测数据展示 -->
      <div class="sidebar-main-item" @click="toggleSidebar('item2')">
        海水入侵历史监测数据展示
        <span>{{ sidebarOpen.item2 ? '▾' : '▸' }}</span>
      </div>
      <div class="sidebar-sub-list" :class="{show: sidebarOpen.item2}">
        <div class="sidebar-sub-item" @click="loadHistoricalData()">历史监测数据</div>
        <div class="sidebar-sub-item" @click="clearAllLayers()">观测要素管理</div>
      </div>

      <!-- 模块3：海水入侵历史监测数据统计分析 -->
      <div class="sidebar-main-item" @click="toggleSidebar('item3')">
        海水入侵历史监测数据统计分析
        <span>{{ sidebarOpen.item3 ? '▾' : '▸' }}</span>
      </div>
      <div class="sidebar-sub-list" :class="{show: sidebarOpen.item3}">
        <div class="sidebar-sub-item" @click="loadStationStatistics()">监测站点统计</div>
      </div>

      <!-- 模块4：海水入侵大数据预报展示功能 -->
      <div class="sidebar-main-item" @click="toggleSidebar('item4')">
        海水入侵大数据预报展示功能
        <span>{{ sidebarOpen.item4 ? '▾' : '▸' }}</span>
      </div>
      <div class="sidebar-sub-list" :class="{show: sidebarOpen.item4}">
        <div class="sidebar-sub-item" @click="clearAllLayers()">海水入侵大数据预测</div>
        <div class="sidebar-sub-item" @click="clearAllLayers()">海水入侵空间分布区划</div>
      </div>

      <!-- 模块5：海水入侵风险预警和辅助决策展示功能 -->
      <div class="sidebar-main-item" @click="toggleSidebar('item5')">
        海水入侵风险预警和辅助决策展示功能
        <span>{{ sidebarOpen.item5 ? '▾' : '▸' }}</span>
      </div>
      <div class="sidebar-sub-list" :class="{show: sidebarOpen.item5}">
        <div class="sidebar-sub-item" @click="loadRiskWarningStations()">海水入侵风险预警</div>
        <div class="sidebar-sub-item" @click="openPdfPopup()">海水入侵适应技术</div>
      </div>
    </div>

    <!-- 地图切换按钮 -->
    <div class="map-switch">
      <button class="switch-btn" :class="{active: mapType === 'vec'}" @click="switchMap('vec')">矢量图</button>
      <button class="switch-btn" :class="{active: mapType === 'img'}" @click="switchMap('img')">影像图</button>
    </div>

    <!-- 历史数据表格 -->
    <div class="history-table-container" :class="{show: isTableShow}">
      <div class="table-header">
        海水入侵电导率历史监测数据
        <span class="close-table" @click="closeTable()">×</span>
      </div>
      <div class="table-content">
        <!-- 搜索区 -->
        <div class="search-area">
          <label>站点名：</label>
          <input type="text" v-model="searchStationName" placeholder="输入站点名搜索">
          <label>采集时间：</label>
          <input type="text" v-model="searchTime" placeholder="输入时间搜索">
        </div>
        <div class="loading" v-if="isLoading">数据加载中...</div>
        <table class="history-table" v-else>
          <thead>
            <tr>
              <th>站点名称</th>
              <th>采集时间</th>
              <th>监测项名称</th>
              <th>检测值</th>
            </tr>
          </thead>
          <tbody>
            <tr v-for="(item, index) in filteredMeasurements" :key="index">
              <td>{{ item.stationName }}</td>
              <td>{{ item.collectTime }}</td>
              <td>{{ item.monitorItem }}</td>
              <td>{{ item.monitorValue }}</td>
            </tr>
            <tr v-if="filteredMeasurements.length === 0 && !isLoading">
              <td colspan="4" style="text-align: center;">未找到匹配数据</td>
            </tr>
          </tbody>
        </table>

        <!-- 新增：分页控件 -->
        <div class="pagination" v-if="!isLoading && totalCount > 0">
          <div class="pagination-controls">
            <!-- 上一页 -->
            <button class="page-btn" @click="currentPage > 1 && (currentPage--, loadPageData())"
              :disabled="currentPage === 1">
              上一页
            </button>

            <!-- 页码按钮（显示当前页前后2页，最多显示5个页码） -->
            <button class="page-num" v-for="num in getPageNumbers()" :key="num"
              @click="currentPage = num; loadPageData()" :class="{active: currentPage === num}">
              {{ num }}
            </button>

            <!-- 下一页 -->
            <button class="page-btn" @click="currentPage < totalPages && (currentPage++, loadPageData())"
              :disabled="currentPage === totalPages">
              下一页
            </button>

            <!-- 每页条数选择 -->
            <div class="page-size-select">
              <label>每页：</label>
              <select v-model="pageSize" @change="handlePageSizeChange()">
                <option value="10">10条</option>
                <option value="20">20条</option>
                <option value="50">50条</option>
              </select>
            </div>

            <!-- 数据统计 -->
            <div class="page-info">
              共 {{ totalCount }} 条数据，共 {{ totalPages }} 页
            </div>
          </div>
        </div>

      </div>
    </div>

    <!-- 1. 站点数据弹窗（点击站点后显示） -->
    <div class="station-data-popup" id="stationDataPopup" :class="{show: isStationPopupShow}">
      <div class="popup-header">
        <span id="popupTitle">{{ popupTitle }}</span>
        <span class="popup-close" @click="closeStationPopup()">×</span>
      </div>
      <div class="popup-content" id="stationPopupContent">
        <!-- 使用响应式展示：加载中 / 显示基本信息（html） / 显示表格 -->
        <div class="loading" v-if="isPopupLoading">数据加载中...</div>

        <!-- 当 stationPopupHtml 有值时，用 v-html 显示（基本信息或自定义 html） -->
        <div v-else-if="stationPopupHtml" v-html="stationPopupHtml"></div>

        <!-- 否则按数据数组渲染表格 -->
        <table class="history-table" v-else>
          <thead>
            <tr>
              <th>采集时间</th>
              <th>监测项名称</th>
              <th>检测值</th>
            </tr>
          </thead>
          <tbody>
            <tr v-for="(item, index) in stationPopupData" :key="index">
              <td>{{ item.collectTime }}</td>
              <td>{{ item.monitorItem }}</td>
              <td>{{ item.monitorValue }}</td>
            </tr>
            <tr v-if="stationPopupData.length === 0">
              <td colspan="3" style="text-align:center;">暂无该站点数据</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- 2. 全量数据控制区（右侧按钮+搜索） -->
    <div class="full-data-control" v-if="currentView === 'seawater'">
      <button class="full-data-btn" @click="showAllMeasurements()">表格形式展示</button>
    </div>

    <div class="station-data-popup" :class="{show: isPdfPopupShow}">
      <div class="popup-header">
        <span>海水入侵适应技术（防护指南）</span>
        <span class="popup-close" @click="isPdfPopupShow = false">×</span>
      </div>
      <div class="popup-content" style="padding: 0;">
        <!-- PDF预览：用iframe加载，支持滚动 -->
        <iframe :src="pdfUrl" style="width: 100%; height: 70vh; border: none;" frameborder="0" allow="scroll"></iframe>
        <!-- 备用提示（如果PDF加载失败显示） -->
        <div class="loading" v-if="!pdfUrl">PDF加载中...</div>
      </div>
    </div>

    <!-- 站点统计图表弹窗（新增） -->
    <div class="station-data-popup" :class="{show: isChartPopupShow}">
      <div class="popup-header">
        <span>监测站点统计（时间维度）</span>
        <span class="popup-close" @click="closeChartPopup()">×</span>
      </div>
      <div class="popup-content" style="padding: 20px; height: 500px;">
        <!-- 图表切换按钮 -->
        <div style="text-align: right; margin-bottom: 10px;">
          <button class="full-data-btn" @click="toggleChartType()">
            {{ chartType === 'line' ? '切换为柱状图' : '切换为折线图' }}
          </button>
        </div>
        <!-- 图表容器 -->
        <div id="stationChart" style="width: 100%; height: 430px;"></div>
      </div>
    </div>

    <div class="station-data-popup" :class="{show: isRiskChartPopupShow}">
      <div class="popup-header">
        <span id="riskChartTitle">海水监测站风险预警</span>
        <span class="popup-close" @click="closeRiskChartPopup()">×</span>
      </div>
      <div class="popup-content" style="padding: 10px; height: 550px; display: flex; flex-direction: column;">
        <!-- 图例说明（与示例图一致） -->
        <div style="display: flex; align-items: center; gap: 20px; margin-bottom: 10px; color: #fff;">
          <div>
            <span
              style="display: inline-block; width: 15px; height: 15px; background: #00ff00; margin-right: 5px;"></span>
            轻度（0-100）
          </div>
          <div>
            <span
              style="display: inline-block; width: 15px; height: 15px; background: #ffff00; margin-right: 5px;"></span>
            轻度（100-200）
          </div>
          <div>
            <span
              style="display: inline-block; width: 15px; height: 15px; background: #ff0000; margin-right: 5px;"></span>
            重度（>200）
          </div>
        </div>
        <!-- 图表容器 -->
        <div id="riskChart" style="width: 100%; height: 100%; flex: 1;"></div>
      </div>
    </div>

  </div>

  <script>
    const { createApp, onMounted, ref, reactive, watch } = Vue; // 完整导入所有需要的API
    createApp({
      setup() {
        // 核心变量：地图实例
        let map = null;
        let currentTileLayer = null;
        let stationMarkers = [];
        let shpLayer = null;

        // 状态变量
        const activeMenu = ref('');
        const btnText2 = ref('海平面上升影响');
        const currentView = ref('');
        const isStationActive = ref(false);
        const sidebarOpen = reactive({
          item1: true,
          item2: false,
          item3: false,
          item4: false,
          item5: false
        });
        const mapType = ref('vec');
        const isPdfPopupShow = ref(false);
        const pdfUrl = ref(''); // 用于存储PDF文件的路径
        // 图表弹窗相关状态（新增）
        const isChartPopupShow = ref(false); // 控制图表弹窗显示/隐藏
        const chartType = ref('line'); // 图表类型：line=折线图，bar=柱状图
        let chartInstance = null; // ECharts实例（全局存储，用于切换类型）
        // 表格相关状态
        const isTableShow = ref(false);
        const isLoading = ref(false);
        const tableData = ref([]);
        // 搜索相关状态
        const searchStationName = ref('');
        const searchTime = ref('');
        const filteredMeasurements = ref([]);
        // 站点弹窗相关状态
        const isPopupLoading = ref(false);
        const stationPopupData = ref([]);

        const isStationPopupShow = ref(false);   // 控制站点弹窗显示
        const popupTitle = ref('站点监测数据');   // 弹窗标题
        const stationPopupHtml = ref('');        // 如果需要显示自定义 html，可写入这里（v-html）

        // 分页相关状态（新增）
        const currentPage = ref(1); // 当前页码（默认第1页）
        const pageSize = ref(10); // 每页显示条数（默认10条）
        const totalCount = ref(0); // 总数据量
        const totalPages = ref(0); // 总页数

        // 风险预警图表弹窗状态（新增）
        const isRiskChartPopupShow = ref(false);
        let riskChartInstance = null; // ECharts实例（风险预警图表）

        // 清除所有图层（站点+SHP+表格+弹窗）
        const clearAllLayers = () => {
          // 清除站点标记
          stationMarkers.forEach(marker => map.removeLayer(marker));
          stationMarkers = [];
          isStationActive.value = false;
          // 清除SHP图层
          if (shpLayer) {
            map.removeLayer(shpLayer);
            shpLayer = null;
          }
          // 隐藏表格+重置搜索
          isTableShow.value = false;
          tableData.value = [];
          filteredMeasurements.value = [];
          searchStationName.value = '';
          searchTime.value = '';
          // 关闭站点弹窗
          closeStationPopup();
        };

        // 加载站点（从数据库获取）
        const loadSeawaterStations = () => {
          clearAllLayers();
          isStationActive.value = true;

          fetch("/api/stations")
            .then(res => {
              if (!res.ok) throw new Error(`接口请求失败，状态码：${res.status}`);
              return res.json();
            })
            .then(stationList => {
              // 站点去重
              const uniqueStations = {};
              stationList.forEach(station => {
                const key = `${station.stationName}-${station.longitude}-${station.latitude}`;
                if (!uniqueStations[key]) {
                  uniqueStations[key] = station;
                }
              });
              const uniqueStationList = Object.values(uniqueStations);

              // 自定义站点图标
              const stationIcon = L.divIcon({
                className: "custom-station-icon",
                html: `
                  <div style="
                    width: 20px;
                    height: 20px;
                    background: #ff3333;
                    border: 2px solid #ffffff;
                    border-radius: 50% 50% 50% 0;
                    transform: rotate(-45deg);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 12px;
                    color: #fff;
                    font-weight: bold;
                    box-shadow: 0 0 5px rgba(0,0,0,0.3);
                  ">
                    <span style="transform: rotate(45deg);">站</span>
                  </div>
                `,
                iconSize: [20, 20],
                iconAnchor: [10, 10],
                tooltipAnchor: [15, 0]
              });

              // 渲染站点+绑定点击事件
              uniqueStationList.forEach(station => {
                const lon = Number(station.longitude);
                const lat = Number(station.latitude);
                const stationName = station.stationName || "未知站点";

                if (isNaN(lon) || isNaN(lat) || lon < -180 || lon > 180 || lat < -90 || lat > 90) {
                  console.warn(`跳过无效站点：${stationName}`);
                  return;
                }

                const marker = L.marker([lat, lon], { icon: stationIcon })
                  .addTo(map)
                  .bindTooltip(stationName, {
                    permanent: true,
                    direction: "right",
                    offset: L.point(5, 0),
                    className: "station-tooltip"
                  })
                  .on('click', () => {
                    showStationBasicInfo(station);
                  });

                stationMarkers.push(marker);
              });

              // 地图定位
              if (stationMarkers.length > 0) {
                const bounds = L.latLngBounds(stationMarkers.map(m => m.getLatLng()));
                map.fitBounds(bounds, { padding: [30, 30] });
              } else {
                alert("未获取到有效站点数据");
              }
            })
            .catch(err => {
              console.error("站点加载失败：", err);
              alert(`站点加载失败：${err.message}`);
            });
        };




        // 加载历史数据（渲染站点+点击弹数据）
        const loadHistoricalData = () => {
          clearAllLayers(); // 清除所有内容（避免冲突）
          isStationActive.value = true;
          isTableShow.value = false; // 隐藏全量表格

          fetch("/api/stations")
            .then(res => {
              if (!res.ok) throw new Error(`接口请求失败，状态码：${res.status}`);
              return res.json();
            })
            .then(stationList => {
              // 1. 站点去重（避免重复渲染）
              const uniqueStations = {};
              stationList.forEach(station => {
                const key = `${station.stationName}-${station.longitude}-${station.latitude}`;
                if (!uniqueStations[key]) {
                  uniqueStations[key] = station;
                }
              });
              const uniqueStationList = Object.values(uniqueStations);

              // 2. 自定义站点图标（和标注监测功能保持一致，便于区分）
              const stationIcon = L.divIcon({
                className: "custom-station-icon",
                html: `
                  <div style="
                    width: 20px;
                    height: 20px;
                    background: #ff3333;
                    border: 2px solid #ffffff;
                    border-radius: 50% 50% 50% 0;
                    transform: rotate(-45deg);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 12px;
                    color: #fff;
                    font-weight: bold;
                    box-shadow: 0 0 5px rgba(0,0,0,0.3);
                  ">
                    <span style="transform: rotate(45deg);">历</span> <!-- 用“历”字区分历史数据功能的站点 -->
                  </div>
                `,
                iconSize: [20, 20],
                iconAnchor: [10, 10],
                tooltipAnchor: [15, 0]
              });

              // 3. 渲染站点：点击触发“查询历史数据”（核心修改）
              uniqueStationList.forEach(station => {
                const lon = Number(station.longitude);
                const lat = Number(station.latitude);
                const stationName = station.stationName || "未知站点";

                if (isNaN(lon) || isNaN(lat) || lon < -180 || lon > 180 || lat < -90 || lat > 90) {
                  console.warn(`跳过无效站点：${stationName}`);
                  return;
                }

                const marker = L.marker([lat, lon], { icon: stationIcon })
                  .addTo(map)
                  .bindTooltip(`${stationName}（历史数据）`, { //  tooltip提示“历史数据”，便于区分
                    permanent: true,
                    direction: "right",
                    offset: L.point(5, 0),
                    className: "station-tooltip"
                  })
                  // 关键：点击调用“查询历史数据”方法
                  .on('click', () => {
                    openStationPopup(stationName);
                  });

                stationMarkers.push(marker);
              });

              // 4. 地图自动定位到所有站点
              if (stationMarkers.length > 0) {
                const bounds = L.latLngBounds(stationMarkers.map(m => m.getLatLng()));
                map.fitBounds(bounds, { padding: [30, 30] });
              } else {
                alert("未获取到有效站点数据");
              }
            })
            .catch(err => {
              console.error("站点加载失败：", err);
              alert(`站点加载失败：${err.message}`);
            });
        };

        // 显示站点基础资料（使用 stationPopupHtml，不直接修改 DOM）
        const showStationBasicInfo = (station) => {
          popupTitle.value = `${station.stationName || '未知站点'} 基础资料`;
          isPopupLoading.value = false;

          // 构造安全的 HTML 展示（这里纯展示，不包含 Vue 指令）
          stationPopupHtml.value = `
    <div style="padding: 15px; color: #fff; font-size: 13px; line-height: 2;">
      <p>站点名称：${station.stationName || "未知站点"}</p>
      <p>所属区域：${station.region || "未知区域"}</p>
      <p>经纬度：${station.latitude || "未知"}，${station.longitude || "未知"}</p>
      <p>站点类型：${station.stationType || "未知类型"}</p>
      <p>建设日期：${station.buildDate ? station.buildDate.replace('T', ' ') : "未知日期"}</p>
    </div>
  `;
          // 显示弹窗
          isStationPopupShow.value = true;
        };

        // 打开站点历史数据弹窗（不再直接 innerHTML，使用 stationPopupData 渲染表格）
        const openStationPopup = (stationName) => {
          popupTitle.value = `${stationName} 历史监测数据`;
          isPopupLoading.value = true;
          stationPopupHtml.value = '';      // 清空 html 模式
          stationPopupData.value = [];      // 清空数据数组
          isStationPopupShow.value = true;

          fetch(`/api/measurements/${encodeURIComponent(stationName)}`)
            .then(res => {
              if (!res.ok) throw new Error(`数据请求失败，状态码：${res.status}`);
              return res.json();
            })
            .then(data => {
              const formattedData = data.map(item => ({
                ...item,
                collectTime: item.collectTime ? item.collectTime.replace('T', ' ') : "未知时间",
                monitorValue: item.monitorValue !== null ? Number(item.monitorValue).toFixed(2) : "无数据"
              }));
              stationPopupData.value = formattedData;
              isPopupLoading.value = false;
            })
            .catch(err => {
              console.error("站点数据加载失败：", err);
              isPopupLoading.value = false;
              stationPopupHtml.value = `<div style="padding:20px;color:#fff;text-align:center;">数据加载失败：${err.message}</div>`;
            });
        };



        // 关闭站点数据弹窗
        const closeStationPopup = () => {
          isStationPopupShow.value = false;
          stationPopupData.value = [];
          stationPopupHtml.value = '';
          isPopupLoading.value = false;
        };

        // 显示所有监测数据（表格形式）
        const showAllMeasurements = () => {
          clearAllLayers();
          isTableShow.value = true;
          isLoading.value = true;
          currentPage.value = 1; // 重置为第1页

          fetch("/api/measurements")
            .then(res => {
              if (!res.ok) throw new Error(`数据请求失败，状态码：${res.status}`);
              return res.json();
            })
            .then(data => {
              // 1. 格式化全量数据
              const formattedData = data.map(item => ({
                stationName: item.stationName || "未知站点",
                collectTime: item.collectTime ? item.collectTime.replace('T', ' ') : "未知时间",
                monitorItem: item.monitorItem || "电导率",
                monitorValue: item.monitorValue !== null ? item.monitorValue.toFixed(2) : "无数据"
              }));
              tableData.value = formattedData;
              totalCount.value = formattedData.length; // 总数据量
              totalPages.value = Math.ceil(totalCount.value / pageSize.value); // 计算总页数

              // 2. 加载第一页数据
              loadPageData();

              isLoading.value = false;

              // 3. 搜索功能与分页联动（搜索后重置分页）
              watch([searchStationName, searchTime], () => {
                const name = searchStationName.value.trim().toLowerCase();
                const time = searchTime.value.trim().toLowerCase();
                // 搜索筛选
                const filtered = tableData.value.filter(item => {
                  const matchName = item.stationName.toLowerCase().includes(name);
                  const matchTime = item.collectTime.toLowerCase().includes(time);
                  return matchName && matchTime;
                });
                // 搜索后重置分页
                totalCount.value = filtered.length;
                totalPages.value = Math.ceil(totalCount.value / pageSize.value);
                currentPage.value = 1;
                // 加载搜索后的第一页数据
                filteredMeasurements.value = filtered.slice(0, pageSize.value);
              });
            })
            .catch(err => {
              console.error("全量数据加载失败：", err);
              alert(`全量数据加载失败：${err.message}`);
              isLoading.value = false;
            });
        };

        // 新增：加载指定页的数据
        const loadPageData = () => {
          // 计算数据切片的起始和结束索引
          const startIndex = (currentPage.value - 1) * pageSize.value;
          const endIndex = startIndex + pageSize.value;
          // 切片获取当前页数据
          filteredMeasurements.value = tableData.value.slice(startIndex, endIndex);
        };

        // 关闭表格
        const closeTable = () => {
          isTableShow.value = false;
          tableData.value = [];
          filteredMeasurements.value = [];
          searchStationName.value = '';
          searchTime.value = '';
        };

        // 加载SHP风险线
        const loadShpGeoJson = () => {
          clearAllLayers();
          fetch("/api/shp/geojson")
            .then(res => res.json())
            .then(data => {
              shpLayer = L.geoJSON(data, {
                style: () => ({ color: "#ff0000", weight: 6, opacity: 0.8 })
              }).addTo(map);
            })
            .catch(err => {
              console.error("SHP加载失败：", err);
              alert("SHP风险线加载失败");
            });
        };

        // 回到初始界面
        const resetToInitial = () => {
          btnText2.value = '海平面上升影响';
          activeMenu.value = '';
          currentView.value = '';
          clearAllLayers();
          map.setView([31.2304, 121.4737], 10);
        };

        const toggleMenu = (menuName) => {
          activeMenu.value = activeMenu.value === menuName ? '' : menuName;
        };

        const switchView = (viewType) => {
          currentView.value = viewType;
          btnText2.value = event.target.innerText;
          activeMenu.value = '';
          clearAllLayers();
          if (viewType === 'seawater') {
            sidebarOpen.item1 = true;
            Object.keys(sidebarOpen).forEach(key => {
              if (key !== 'item1') sidebarOpen[key] = false;
            });
          }
        };

        const toggleSidebar = (itemKey) => {
          Object.keys(sidebarOpen).forEach(key => {
            sidebarOpen[key] = (key === itemKey) ? !sidebarOpen[key] : false;
          });
          clearAllLayers();
        };

        // 初始化地图（确保DOM加载后执行）
        const initMap = () => {
          map = L.map('map').setView([31.2304, 121.4737], 10);
          switchMap('vec');
        };

        const switchMap = (type) => {
          mapType.value = type;
          if (currentTileLayer) map.removeLayer(currentTileLayer);
          const tileUrl = type === 'vec'
            ? 'https://webrd0{s}.is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=8&x={x}&y={y}&z={z}'
            : 'https://webst0{s}.is.autonavi.com/appmaptile?style=6&x={x}&y={y}&z={z}';
          currentTileLayer = L.tileLayer(tileUrl, {
            subdomains: ['1', '2', '3', '4'],
            attribution: '© 高德地图'
          }).addTo(map);
        };

        // 新增：获取要显示的页码列表（最多显示5个页码，当前页居中）
        const getPageNumbers = () => {
          const pages = [];
          // 总页数<=5时，显示所有页码
          if (totalPages.value <= 5) {
            for (let i = 1; i <= totalPages.value; i++) {
              pages.push(i);
            }
          } else {
            // 总页数>5时，显示当前页前后2页
            if (currentPage.value <= 3) {
              pages.push(1, 2, 3, 4, 5);
            } else if (currentPage.value >= totalPages.value - 2) {
              pages.push(
                totalPages.value - 4,
                totalPages.value - 3,
                totalPages.value - 2,
                totalPages.value - 1,
                totalPages.value
              );
            } else {
              pages.push(
                currentPage.value - 2,
                currentPage.value - 1,
                currentPage.value,
                currentPage.value + 1,
                currentPage.value + 2
              );
            }
          }
          return pages;
        };

        // 新增：改变每页条数时重置分页
        const handlePageSizeChange = () => {
          totalPages.value = Math.ceil(totalCount.value / pageSize.value);
          currentPage.value = 1; // 重置为第1页
          loadPageData(); // 加载新条数的第一页
        };

        const openPdfPopup = () => {
          try {
            // 1. 设置PDF路径（替换为你的实际文件路径）
            pdfUrl.value = '/海水入侵防护指南.pdf';
            // 2. 显示弹窗
            isPdfPopupShow.value = true;
            // 3. 清除其他内容（避免冲突）
            clearAllLayers();
            closeStationPopup();
          } catch (err) {
            console.error("打开PDF失败：", err);
            alert("PDF加载失败，请检查文件路径");
          }
        };

        // 1. 加载站点统计数据并渲染图表（点击“监测站点统计”时调用）
        const loadStationStatistics = () => {
          clearAllLayers(); // 清除地图上的站点/表格，避免冲突
          closeStationPopup(); // 关闭其他弹窗
          isChartPopupShow.value = true; // 显示图表弹窗
          isLoading.value = true;

          // 调用后端新增接口，获取所有站点的创立时间
          fetch("/api/stations/statistics/build-date")
            .then(res => {
              if (!res.ok) throw new Error(`接口请求失败，状态码：${res.status}`);
              return res.json();
            })
            .then(stationList => {
              isLoading.value = false;
              // 处理数据：统计每年的站点数量（核心逻辑）
              const dateCountMap = {};
              stationList.forEach(station => {
                if (station.buildDate) {
                  // 提取年份（如2005-09-27 → 2005）
                  const year = station.buildDate.split('-')[0];
                  // 统计该年份的站点数
                  dateCountMap[year] = (dateCountMap[year] || 0) + 1;
                }
              });

              // 格式化数据：ECharts需要的“年份数组”和“数量数组”
              const years = Object.keys(dateCountMap).sort(); // 年份排序（从小到大）
              const counts = years.map(year => dateCountMap[year]);

              // 渲染图表
              renderChart(years, counts);
            })
            .catch(err => {
              console.error("站点统计数据加载失败：", err);
              alert(`站点统计数据加载失败：${err.message}`);
              isLoading.value = false;
              isChartPopupShow.value = false;
            });
        };

        // 2. 渲染ECharts图表（折线图/柱状图）
        const renderChart = (xData, yData) => {
          // 初始化ECharts实例（绑定图表容器）
          chartInstance = echarts.init(document.getElementById('stationChart'));

          // 图表配置项（支持切换类型）
          const option = {
            tooltip: {
              trigger: 'axis',
              axisPointer: { type: 'shadow' },
              textStyle: { color: '#fff' }
            },
            legend: {
              data: ['站点数量'],
              textStyle: { color: '#fff' }
            },
            grid: {
              left: '3%',
              right: '4%',
              bottom: '3%',
              containLabel: true
            },
            xAxis: {
              type: 'category',
              data: xData,
              axisLine: { lineStyle: { color: '#00ccff' } },
              axisLabel: { color: '#fff' }
            },
            yAxis: {
              type: 'value',
              min: 0,
              axisLine: { lineStyle: { color: '#00ccff' } },
              axisLabel: {
                color: '#fff',
                formatter: '{value} 个' // 纵轴显示“XX个”
              },
              splitLine: { lineStyle: { color: 'rgba(0, 204, 255, 0.2)' } }
            },
            series: [{
              name: '站点数量',
              type: chartType.value, // 动态切换图表类型
              data: yData,
              lineStyle: { color: '#ff3333', width: 3 }, // 折线图样式
              itemStyle: {
                color: '#ff3333', // 折线点/柱状图颜色
                borderColor: '#fff',
                borderWidth: 2
              },
              symbol: 'circle',
              symbolSize: 8
            }],
            backgroundColor: 'transparent' // 透明背景，适配弹窗样式
          };

          // 渲染图表
          chartInstance.setOption(option);
          // 窗口 resize 时自适应图表
          window.addEventListener('resize', () => chartInstance.resize());
        };

        // 3. 切换图表类型（折线图 ↔ 柱状图）
        const toggleChartType = () => {
          chartType.value = chartType.value === 'line' ? 'bar' : 'line';
          // 重新获取数据并渲染（简化逻辑，直接复用现有数据）
          const xData = chartInstance.getOption().xAxis[0].data;
          const yData = chartInstance.getOption().series[0].data;
          renderChart(xData, yData);
        };

        // 4. 关闭图表弹窗
        const closeChartPopup = () => {
          isChartPopupShow.value = false;
          // 销毁ECharts实例，释放资源
          if (chartInstance) {
            chartInstance.dispose();
            chartInstance = null;
          }
        };

        // 1. 加载风险预警站点（点击“海水入侵风险预警”时调用）
        const loadRiskWarningStations = () => {
          clearAllLayers(); // 清除其他内容
          isStationActive.value = true;
          isRiskChartPopupShow.value = false;

          fetch("/api/stations")
            .then(res => {
              if (!res.ok) throw new Error(`站点请求失败，状态码：${res.status}`);
              return res.json();
            })
            .then(stationList => {
              // 站点去重（复用原有逻辑）
              const uniqueStations = {};
              stationList.forEach(station => {
                const key = `${station.stationName}-${station.longitude}-${station.latitude}`;
                if (!uniqueStations[key]) uniqueStations[key] = station;
              });
              const uniqueStationList = Object.values(uniqueStations);

              // 自定义风险预警站点图标（区分其他功能）
              const riskStationIcon = L.divIcon({
                className: "custom-station-icon",
                html: `
          <div style="
            width: 20px;
            height: 20px;
            background: #00ccff;
            border: 2px solid #ffffff;
            border-radius: 50% 50% 50% 0;
            transform: rotate(-45deg);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: #002244;
            font-weight: bold;
            box-shadow: 0 0 5px rgba(0,0,0,0.3);
          ">
            <span style="transform: rotate(45deg);">警</span>
          </div>
        `,
                iconSize: [20, 20],
                iconAnchor: [10, 10],
                tooltipAnchor: [15, 0]
              });

              // 渲染站点：点击触发风险预警图表
              uniqueStationList.forEach(station => {
                const lon = Number(station.longitude);
                const lat = Number(station.latitude);
                const stationName = station.stationName || "未知站点";

                if (isNaN(lon) || isNaN(lat)) return;

                const marker = L.marker([lat, lon], { icon: riskStationIcon })
                  .addTo(map)
                  .bindTooltip(`${stationName}（风险预警）`, {
                    permanent: true,
                    direction: "right",
                    className: "station-tooltip"
                  })
                  // 绑定新的点击事件（打开风险预警图表）
                  .on('click', () => {
                    openRiskChartPopup(stationName, station.latitude, station.longitude);
                  });

                stationMarkers.push(marker);
              });

              // 地图定位
              if (stationMarkers.length > 0) {
                const bounds = L.latLngBounds(stationMarkers.map(m => m.getLatLng()));
                map.fitBounds(bounds, { padding: [30, 30] });
              }
            })
            .catch(err => {
              console.error("风险预警站点加载失败：", err);
              alert(`站点加载失败：${err.message}`);
            });
        };

        // 2. 打开风险预警图表弹窗
        const openRiskChartPopup = (stationName, lat, lon) => {
          isLoading.value = true;
          // 设置弹窗标题（包含经纬度）
          document.getElementById('riskChartTitle').innerText =
            `海水监测站-${stationName}（${lon.toFixed(4)}E,${lat.toFixed(4)}N）风险预警`;
          isRiskChartPopupShow.value = true;

          // 调用原有接口获取该站点的历史数据（复用现有接口，不新增后端代码）
          fetch(`/api/measurements/${stationName}`)
            .then(res => {
              if (!res.ok) throw new Error(`数据请求失败，状态码：${res.status}`);
              return res.json();
            })
            .then(data => {
              isLoading.value = false;
              // 格式化数据：提取时间和电导率
              const formattedData = data.filter(item => item.monitorValue !== null) // 过滤无效数据
                .map(item => ({
                  time: item.collectTime ? item.collectTime.replace('T', ' ') : "未知时间",
                  conductivity: item.monitorValue // 电导率值
                }));

              // 渲染风险预警图表
              renderRiskChart(formattedData);
            })
            .catch(err => {
              console.error("风险预警数据加载失败：", err);
              alert(`数据加载失败：${err.message}`);
              isLoading.value = false;
            });
        };

        // 3. 渲染风险预警图表（电导率曲线+分级阈值）
        const renderRiskChart = (data) => {
          // 初始化ECharts实例
          riskChartInstance = echarts.init(document.getElementById('riskChart'));

          // 提取横轴（时间）和纵轴（电导率）数据
          const xData = data.map(item => item.time);
          const yData = data.map(item => item.conductivity);

          // 图表配置（匹配示例样式）
          const option = {
            tooltip: {
              trigger: 'axis',
              formatter: (params) => {
                const param = params[0];
                return `
          时间：${param.name}<br/>
          电导率：${param.value} mg/L<br/>
          风险等级：${getRiskLevel(param.value)}
        `;
              },
              textStyle: { color: '#fff' }
            },
            grid: {
              left: '5%',
              right: '5%',
              bottom: '10%',
              top: '5%',
              containLabel: true
            },
            xAxis: {
              type: 'category',
              data: xData,
              axisLine: { lineStyle: { color: '#00ccff' } },
              axisLabel: {
                color: '#fff',
                rotate: 30, // 时间文本旋转，避免重叠
                margin: 10
              },
              splitLine: { show: false }
            },
            yAxis: {
              type: 'value',
              min: 0,
              axisLine: { lineStyle: { color: '#00ccff' } },
              axisLabel: {
                color: '#fff',
                formatter: '{value} mg/L'
              },
              splitLine: { lineStyle: { color: 'rgba(0, 204, 255, 0.2)' } },
              // 添加分级阈值线（黄色：100，红色：200）
              splitArea: { show: false },
              axisPointer: { type: 'shadow' }
            },
            series: [
              // 电导率曲线
              {
                name: '电导率',
                type: 'line',
                data: yData,
                lineStyle: { color: '#1E90FF', width: 2 },
                itemStyle: { color: '#1E90FF', borderColor: '#fff', borderWidth: 2 },
                symbol: 'circle',
                symbolSize: 6,
                smooth: true // 曲线平滑
              },
              // 无入侵-轻度阈值线（黄色：100）
              {
                name: '无入侵阈值',
                type: 'line',
                data: Array(xData.length).fill(100),
                lineStyle: { color: '#ffff00', width: 2, type: 'solid' },
                symbol: 'none',
                emphasis: { disabled: true }
              },
              // 轻度-重度阈值线（红色：200）
              {
                name: '轻度入侵阈值',
                type: 'line',
                data: Array(xData.length).fill(200),
                lineStyle: { color: '#ff0000', width: 2, type: 'solid' },
                symbol: 'none',
                emphasis: { disabled: true }
              }
            ],
            backgroundColor: 'transparent'
          };

          // 渲染图表
          riskChartInstance.setOption(option);
          // 窗口自适应
          window.addEventListener('resize', () => riskChartInstance.resize());
        };

        // 辅助函数：根据电导率获取风险等级
        const getRiskLevel = (value) => {
          if (value < 100) return '无入侵';
          if (value <= 200) return '轻度入侵';
          return '重度入侵';
        };

        // 4. 关闭风险预警图表弹窗
        const closeRiskChartPopup = () => {
          isRiskChartPopupShow.value = false;
          if (riskChartInstance) {
            riskChartInstance.dispose();
            riskChartInstance = null;
          }
        };


        // 页面挂载后初始化地图
        onMounted(initMap);

        // 暴露所有需要的方法和状态
        return {
          resetToInitial,
          loadShpGeoJson,
          loadSeawaterStations,
          loadHistoricalData,
          showAllMeasurements,
          closeTable,
          clearAllLayers,
          toggleMenu,
          switchView,
          toggleSidebar,
          switchMap,
          openStationPopup,
          closeStationPopup,
          activeMenu,
          btnText2,
          currentView,
          sidebarOpen,
          mapType,
          isStationActive,
          isTableShow,
          isLoading,
          tableData,
          searchStationName,
          searchTime,
          filteredMeasurements,
          isPopupLoading,
          stationPopupData,
          currentPage,
          pageSize,
          totalCount,
          totalPages,
          loadPageData,
          getPageNumbers,
          handlePageSizeChange,
          openPdfPopup,
          isPdfPopupShow,
          pdfUrl,
          isStationPopupShow,
          popupTitle,
          stationPopupHtml,
          showStationBasicInfo,
          openStationPopup,
          closeStationPopup,
          isChartPopupShow,
          loadStationStatistics,
          closeChartPopup,
          toggleChartType,
          isRiskChartPopupShow,
          loadRiskWarningStations,
          closeRiskChartPopup
        };
      }
    }).mount('#app');
  </script>
</body>

</html>